---
title: "IR and Protocols"
description: "How the gateway normalizes requests and maps protocols to IR."
---

The gateway uses a shared intermediate representation (IR) so each protocol only needs one decode path and one encode path.

## IR and shared schemas

`apps/api/src/core` defines normalized request and response primitives:

- `ir.ts` defines shared IR request/response types.
- `schemas.ts` defines Zod request schemas for each endpoint.
- `types.ts` defines endpoint and pipeline type contracts.

## Protocol folders

`apps/api/src/protocols` holds protocol-specific mapping logic.

### OpenAI Chat

`apps/api/src/protocols/openai-chat` includes:

- `decode.ts` to map chat-completions input into IR.
- `encode.ts` to map IR responses back to chat-completions shape.

### OpenAI Responses

`apps/api/src/protocols/openai-responses` includes:

- `decode.ts` to map Responses API input into IR.
- `encode.ts` to map IR responses back to Responses API shape.

### Anthropic Messages

`apps/api/src/protocols/anthropic-messages` includes:

- `decode.ts` for Messages API input to IR.
- `encode.ts` for IR to Messages API output.
- Streaming helpers for Anthropic SSE event mapping.
